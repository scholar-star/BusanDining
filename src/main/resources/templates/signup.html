<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>íšŒì›ê°€ì…</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .signup-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            padding: 40px;
            width: 100%;
            max-width: 500px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .signup-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .signup-header h1 {
            color: #333;
            font-size: 28px;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .signup-header p {
            color: #666;
            font-size: 14px;
        }

        .form-group {
            margin-bottom: 25px;
            position: relative;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 500;
            font-size: 14px;
        }

        .required {
            color: #e74c3c;
            margin-left: 4px;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid #e1e8ed;
            border-radius: 12px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: white;
            outline: none;
        }

        .form-group input:focus,
        .form-group select:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
            transform: translateY(-2px);
        }

        .form-group input:hover,
        .form-group select:hover {
            border-color: #c7d2fe;
        }

        .form-group select:disabled {
            background-color: #f8f9fa;
            color: #6c757d;
            cursor: not-allowed;
        }

        .address-row {
            display: flex;
            gap: 15px;
        }

        .address-row .form-group {
            flex: 1;
            margin-bottom: 25px;
        }

        @media (max-width: 480px) {
            .address-row {
                flex-direction: column;
                gap: 0;
            }
        }

        .signup-btn {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
            position: relative;
            overflow: hidden;
        }

        .signup-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }

        .signup-btn:active {
            transform: translateY(0);
        }

        .login-link {
            text-align: center;
            margin-top: 25px;
            color: #666;
            font-size: 14px;
        }

        .login-link a {
            color: #667eea;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s ease;
        }

        .login-link a:hover {
            color: #5a67d8;
        }

        .error-message {
            color: #e74c3c;
            font-size: 12px;
            margin-top: 5px;
        }

        .field-error {
            border-color: #e74c3c !important;
        }

        .success-message {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
            color: white;
            padding: 16px;
            border-radius: 12px;
            margin-bottom: 20px;
            text-align: center;
        }

        .alert {
            padding: 16px;
            border-radius: 12px;
            margin-bottom: 20px;
            text-align: center;
        }

        .alert-success {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
            color: white;
        }

        .alert-danger {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
        }

        @media (max-width: 480px) {
            .signup-container {
                padding: 30px 20px;
            }

            .signup-header h1 {
                font-size: 24px;
            }
        }

        .password-strength {
            font-size: 12px;
            margin-top: 5px;
            height: 15px;
        }

        .strength-weak { color: #e74c3c; }
        .strength-medium { color: #f39c12; }
        .strength-strong { color: #27ae60; }
    </style>
</head>
<body>
<div class="signup-container">
    <div class="signup-header">
        <h1>íšŒì›ê°€ì…</h1>
        <p>ìƒˆë¡œìš´ ê³„ì •ì„ ë§Œë“¤ì–´ë³´ì„¸ìš”</p>
    </div>

    <!-- ì„±ê³µ ë©”ì‹œì§€ -->
    <div th:if="${successMessage}" class="alert alert-success">
        <span th:text="${successMessage}">íšŒì›ê°€ì…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ‰</span>
    </div>

    <!-- ì—ëŸ¬ ë©”ì‹œì§€ -->
    <div th:if="${errorMessage}" class="alert alert-danger">
        <span th:text="${errorMessage}">ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</span>
    </div>

    <form th:action="@{/busan/auth}" th:object="${userDTO}" method="post" novalidate>
        <div class="form-group">
            <label for="name">ì´ë¦„<span class="required">*</span></label>
            <input type="text"
                   id="name"
                   th:field="*{username}"
                   th:class="${#fields.hasErrors('username')} ? 'field-error' : ''"
                   placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”">
            <div th:if="${#fields.hasErrors('username')}"
                 th:errors="*{username}"
                 class="error-message">ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.</div>
        </div>

        <div class="form-group">
            <label for="username">ì•„ì´ë””<span class="required">*</span></label>
            <input type="text"
                   id="username"
                   th:field="*{id}"
                   th:class="${#fields.hasErrors('id')} ? 'field-error' : ''"
                   placeholder="ì•„ì´ë””ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
            <div th:if="${#fields.hasErrors('id')}"
                 th:errors="*{id}"
                 class="error-message">ì•„ì´ë””ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.</div>
        </div>

        <div class="form-group">
            <label for="password">ë¹„ë°€ë²ˆí˜¸<span class="required">*</span></label>
            <input type="password"
                   id="password"
                   th:field="*{password}"
                   th:class="${#fields.hasErrors('password')} ? 'field-error' : ''"
                   placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
            <div class="password-strength" id="passwordStrength"></div>
            <div th:if="${#fields.hasErrors('password')}"
                 th:errors="*{password}"
                 class="error-message">ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.</div>
        </div>

        <div class="form-group">
            <label for="email">ì´ë©”ì¼</label>
            <input type="email"
                   id="email"
                   th:field="*{email}"
                   th:class="${#fields.hasErrors('email')} ? 'field-error' : ''"
                   placeholder="example@email.com">
            <div th:if="${#fields.hasErrors('email')}"
                 th:errors="*{email}"
                 class="error-message">ì˜¬ë°”ë¥¸ ì´ë©”ì¼ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤.</div>
        </div>

        <div class="address-row">
            <div class="form-group">
                <label for="gu">êµ¬</label>
                <select id="gu" th:field="*{city}">
                    <option value="">êµ¬ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
                    <option value="ê°•ì„œêµ¬">ê°•ì„œêµ¬</option>
                    <option value="ê¸ˆì •êµ¬">ê¸ˆì •êµ¬</option>
                    <option value="ê¸°ì¥êµ°">ê¸°ì¥êµ°</option>
                    <option value="ë‚¨êµ¬">ë‚¨êµ¬</option>
                    <option value="ë™êµ¬">ë™êµ¬</option>
                    <option value="ë™ë˜êµ¬">ë™ë˜êµ¬</option>
                    <option value="ë¶êµ¬">ë¶êµ¬</option>
                    <option value="ë¶€ì‚°ì§„êµ¬">ë¶€ì‚°ì§„êµ¬</option>
                    <option value="ì‚¬ìƒêµ¬">ì‚¬ìƒêµ¬</option>
                    <option value="ì‚¬í•˜êµ¬">ì‚¬í•˜êµ¬</option>
                    <option value="ì„œêµ¬">ì„œêµ¬</option>
                    <option value="ìˆ˜ì˜êµ¬">ìˆ˜ì˜êµ¬</option>
                    <option value="ì˜ë„êµ¬">ì˜ë„êµ¬</option>
                    <option value="ì¤‘êµ¬">ì¤‘êµ¬</option>
                    <option value="í•´ìš´ëŒ€êµ¬">í•´ìš´ëŒ€êµ¬</option>
                </select>
            </div>

            <div class="form-group">
                <label for="dong">ë™</label>
                <select id="dong" th:field="*{district}" disabled>
                    <option value="">ë¨¼ì € êµ¬ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
                </select>
            </div>
        </div>

        <!-- CSRF í† í° (Spring Security ì‚¬ìš© ì‹œ) -->
        <input type="hidden"
               th:if="${_csrf != null}"
               th:name="${_csrf.parameterName}"
               th:value="${_csrf.token}" />

        <button type="submit" class="signup-btn">íšŒì›ê°€ì…</button>
    </form>

    <div class="login-link">
        ì´ë¯¸ ê³„ì •ì´ ìˆìœ¼ì‹ ê°€ìš”? <a th:href="@{/login}">ë¡œê·¸ì¸</a>
    </div>
</div>

<script th:inline="javascript">
    /*<![CDATA[*/

    // êµ¬ë³„ ë™ ë°ì´í„° (ì„œë²„ì—ì„œ ì „ë‹¬ë°›ê±°ë‚˜ í•˜ë“œì½”ë”©)
    const addressData = {
        "ê°•ì„œêµ¬" : ["ê°€ë½ë™", "ê°€ë•ë„ë™", "ê°•ë™ë™", "ë…¹ì‚°ë™", "ëŒ€ì €ë™","ëª…ì§€ë™","ì‹ í˜¸ë™"],
        "ê¸ˆì •êµ¬" : ["êµ¬ì„œë™","ê¸ˆì‚¬ë™","ê¸ˆì„±ë™","ë‚¨ì‚°ë™","ë¶€ê³¡ë™","ì„œë™","ì„ ë‘êµ¬ë™","ì¥ì „ë™","ì²­ë£¡ë…¸í¬ë™"],
        "ê¸°ì¥êµ°" : ["ê¸°ì¥ì","ì¼ê´‘ë©´","ì¥ì•ˆì","ì •ê´€ì","ì² ë§ˆë©´"],
        "ë‚¨êµ¬" : ["ê°ë§Œë™","ëŒ€ì—°ë™","ë¬¸í˜„ë™", "ìš©í˜¸ë™","ìš°ì•”ë™"],
        "ë™êµ¬" : ["ë²”ì¼ë™", "ìˆ˜ì •ë™", "ì¢Œì²œë™", "ì´ˆëŸ‰ë™"],
        "ë™ë˜êµ¬": ["ëª…ë¥œë™", "ë³µì‚°ë™", "ì‚¬ì§ë™", "ìˆ˜ë¯¼ë™", "ì•ˆë½ë™", "ì˜¨ì²œë™", "ëª…ì¥ë™"],
        "ë¶êµ¬" : ["êµ¬í¬ë™","ê¸ˆê³¡ë™","ë•ì²œë™","ë§Œë•ë™","í™”ëª…ë™"],
        "ë¶€ì‚°ì§„êµ¬": ["ê°€ì•¼ë™", "ê°œê¸ˆë™", "ë‹¹ê°ë™", "ë²”ì²œë™", "ë¶€ì•”ë™", "ë¶€ì „ë™", "ì—°ì§€ë™", "ì–‘ì •ë™", "ì „í¬ë™", "ì´ˆìë™"],
        "ì‚¬ìƒêµ¬" : ["ê°ì „ë™", "ê´˜ë²•ë™", "ë•í¬ë™", "ëª¨ë¼ë™", "ì‚¼ë½ë™", "ì—„ê¶ë™", "ì£¼ë¡€ë™", "í•™ì¥ë™"],
        "ì‚¬í•˜êµ¬" : ["ê´´ì •ë™", "ë‹¹ë¦¬ë™", "í•˜ë‹¨ë™","ì‹ í‰ë™", "ì¥ë¦¼ë™","ë‹¤ëŒ€ë™","ê°ì²œë™","êµ¬í‰ë™"],
        "ì„œêµ¬" : ["ë‚¨ë¶€ë¯¼ë™", "ë™ëŒ€ì‹ ë™", "ë¶€ë¯¼ë™", "ì„œëŒ€ì‹ ë™", "ì•„ë¯¸ë™", "ì•”ë‚¨ë™", "ì´ˆì¥ë™", "ì¶©ë¬´ë™"],
        "ìˆ˜ì˜êµ¬": ["ê´‘ì•ˆë™", "ë‚¨ì²œë™", "ë§ë¯¸ë™", "ë¯¼ë½ë™", "ìˆ˜ì˜ë™"],
        "ì˜ë„êµ¬" : ["ë‚¨í•­ë™", "ë™ì‚¼ë™", "ë´‰ë˜ë™", "ì˜ì„ ë™", "ì‹ ì„ ë™", "ì²­í•™ë™"],
        "ì¤‘êµ¬" : ["ê´‘ë³µë™", "ë‚¨í¬ë™", "ë™ê´‘ë™", "ëŒ€ì²­ë™", "ë³´ìˆ˜ë™", "ë¶€í‰ë™", "ì¤‘ì•™ë™", "ì˜ì£¼ë™"],
        "í•´ìš´ëŒ€êµ¬": ["ë°˜ì—¬ë™", "ë°˜ì†¡ë™", "ìš°ë™", "ì†¡ì •ë™", "ì¬ì†¡ë™", "ì¤‘ë™", "ì¢Œë™"]
    };

    // êµ¬ ì„ íƒ ì‹œ ë™ ëª©ë¡ ì—…ë°ì´íŠ¸
    document.getElementById('gu').addEventListener('change', function() {
        const guValue = this.value;
        const dongSelect = document.getElementById('dong');

        // ë™ ì„ íƒ ì´ˆê¸°í™”
        dongSelect.innerHTML = '';

        if (guValue === '') {
            dongSelect.innerHTML = '<option value="">ë¨¼ì € êµ¬ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>';
            dongSelect.disabled = true;
        } else {
            dongSelect.innerHTML = '<option value="">ë™ì„ ì„ íƒí•˜ì„¸ìš”</option>';

            // í•´ë‹¹ êµ¬ì˜ ë™ ëª©ë¡ ì¶”ê°€
            if (addressData[guValue]) {
                addressData[guValue].forEach(dong => {
                    const option = document.createElement('option');
                    option.value = dong;
                    option.textContent = dong;
                    dongSelect.appendChild(option);
                });
            }
            dongSelect.disabled = false;
        }
    });

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ê¸°ì¡´ ì„ íƒê°’ ë³µì› (ìœ íš¨ì„± ê²€ì‚¬ ì‹¤íŒ¨ ì‹œ)
    document.addEventListener('DOMContentLoaded', function() {
        const selectedGu = document.getElementById('gu').value;
        const selectedDong = /*[[${signupForm?.dong}]]*/ null;

        if (selectedGu) {
            // êµ¬ê°€ ì„ íƒë˜ì–´ ìˆìœ¼ë©´ ë™ ëª©ë¡ ì—…ë°ì´íŠ¸
            const changeEvent = new Event('change');
            document.getElementById('gu').dispatchEvent(changeEvent);

            // ë™ì´ ì„ íƒë˜ì–´ ìˆìœ¼ë©´ ë³µì›
            if (selectedDong) {
                setTimeout(() => {
                    document.getElementById('dong').value = selectedDong;
                }, 100);
            }
        }
    });

    // ë¹„ë°€ë²ˆí˜¸ ê°•ë„ ì²´í¬
    const passwordInput = document.getElementById('password');
    const passwordStrength = document.getElementById('passwordStrength');

    passwordInput.addEventListener('input', function() {
        const password = this.value;
        if (password.length === 0) {
            passwordStrength.textContent = '';
            return;
        }

        let strength = 0;
        if (password.length >= 8) strength++;
        if (/[a-z]/.test(password)) strength++;
        if (/[A-Z]/.test(password)) strength++;
        if (/[0-9]/.test(password)) strength++;
        if (/[^A-Za-z0-9]/.test(password)) strength++;

        if (strength <= 2) {
            passwordStrength.textContent = 'ì•½í•¨';
            passwordStrength.className = 'password-strength strength-weak';
        } else if (strength <= 3) {
            passwordStrength.textContent = 'ë³´í†µ';
            passwordStrength.className = 'password-strength strength-medium';
        } else {
            passwordStrength.textContent = 'ê°•í•¨';
            passwordStrength.className = 'password-strength strength-strong';
        }
    });

    /*]]>*/
</script>
</body>
</html>